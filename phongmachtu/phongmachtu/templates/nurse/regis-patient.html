{%extends 'layout/base.html'%}

{% block title %}Lập phiếu khám bệnh{% endblock %}

{%block content%}

<header>
    <link href="{{ url_for('static', filename='css/styles.css') }}" rel="stylesheet"/>
</header>

<h1 class="text-center text-primary fw-bold my-4">Đăng Ký Khám Bệnh</h1>
<section style="margin-bottom: 100px">
    {% if msg %}
    <div class="alert alert-danger text-center">
        <i class="fas fa-exclamation-circle"></i> {{ msg }}
    </div>
    {% endif %}

    <!-- Form đăng ký -->
    <div class="container shadow-lg rounded p-5 bg-white border border-2">
        <form method="POST" enctype="multipart/form-data">
            <div class="form-floating mb-4">
                <input type="text" class="form-control shadow-sm" id="name" placeholder="Nhập họ tên" name="name"
                       required>
                <label for="name">Họ và Tên</label>
            </div>

            <div class="form-floating mb-4">
                <input type="text" class="form-control shadow-sm" id="address" name="address" placeholder="Địa chỉ"
                       required>
                <label for="address">Địa chỉ</label>
            </div>

            <div class="form-floating mb-4">
                <input type="date" class="form-control shadow-sm" id="day_of_birth" name="day_of_birth" required>
                <label for="day_of_birth">Ngày sinh</label>
            </div>

            <div class="form-floating mb-4">
                <select class="form-select shadow-sm" id="gender" name="gender" required>
                    <option value="Nam">Nam</option>
                    <option value="Nữ">Nữ</option>
                </select>
                <label for="gender">Giới tính</label>
            </div>

            <div class="form-floating mb-3">
                <input type="text" class="form-control" id="phone" name="phone" placeholder="Số điện thoại"
                       required>
                <label for="phone">Số điện thoại</label>
                <div id="phone-feedback" class="invalid-feedback" style="display: none;"></div>
            </div>

            <div class="form-floating mb-3">
                <input type="text" class="form-control" id="email" name="email" placeholder="Email" required>
                <label for="email">Email</label>
                <div id="email-feedback" class="invalid-feedback" style="display: none;"></div>
            </div>

            <div class="text-center mt-4">
                <button class="btn btn-success btn-lg px-5 shadow-sm" type="submit">
                    Đăng ký
                </button>
            </div>
        </form>
    </div>
</section>
<script>
    let isFormValid = true;

    function checkField(inputId, value) {
        fetch('/check_account', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ [inputId]: value })  // Gửi theo key là tên của trường nhập liệu
        })
        .then(response => response.json())
        .then(data => {
            const feedback = document.querySelector(`#${inputId}-feedback`);
            const input = document.getElementById(inputId);

            if (data.status === 'error') {
                input.classList.add('is-invalid');
                feedback.innerHTML = data.messages.join('<br>');
                feedback.style.display = 'block';
                isFormValid = false;  // Đặt trạng thái form không hợp lệ
            } else {
                input.classList.remove('is-invalid');
                feedback.style.display = 'none';
                isFormValid = true;
            }
        })
        .catch(error => console.error('Error:', error));
    }

    document.getElementById('email').addEventListener('input', function () {
        checkField('email', this.value);
    });
    document.getElementById('phone').addEventListener('input', function () {
        checkField('phone', this.value);
    });

    function checkPasswords() {
        const password = document.getElementById('password').value;
        const confirmPassword = document.getElementById('confirm').value;

        const feedback = document.getElementById('confirm-feedback');
        const confirmInput = document.getElementById('confirm');

        if (password !== confirmPassword) {
            confirmInput.classList.add('is-invalid');  // Thêm class lỗi nếu không khớp
            feedback.style.display = 'block';  // Hiển thị thông báo lỗi
        } else {
            confirmInput.classList.remove('is-invalid');  // Xóa class lỗi nếu khớp
            feedback.style.display = 'none';  // Ẩn thông báo lỗi
        }
    }

    document.querySelector('form').addEventListener('submit', function (event) {
        if (!isFormValid) {
            event.preventDefault();
            alert('Vui lòng sửa thông tin hợp lệ');
        }
    });
</script>


{%endblock%}